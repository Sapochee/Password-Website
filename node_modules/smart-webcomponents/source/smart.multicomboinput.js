
/* Smart UI v19.0.8 (2024-04-29) 
Copyright (c) 2011-2023 jQWidgets. 
License: https://htmlelements.com/license/ */ //

Smart("smart-multi-combo-input",class extends Smart.CheckInput{static get properties(){return{allowItemsAdd:{value:!1,type:"boolean"},allowItemsRemove:{value:!1,type:"boolean"},autoAddNewTags:{value:!0,type:"boolean"},colorItems:{value:!0,type:"boolean"},inputTagsMode:{allowedValues:["one","many"],value:"many",type:"string"},hideInputTagsCloseButton:{value:!1,type:"boolean"},messages:{value:{en:{newItem:"New item",tagLabelOne:"{{value}} item selected",tagLabel:"{{value}} items selected",selectAll:"Select All",unselectAll:"Unselect All"}},type:"object",extend:!0},pills:{value:!1,type:"boolean"},singleSelect:{value:!1,type:"boolean"},selectAll:{value:!1,type:"boolean"}}}template(){return'<div id="inputContainer" role="presentation"><div id="optionsContainer" inner-h-t-m-l=\'{{innerHTML}}\' class="smart-hidden"></div><div class="smart-action-button" role="presentation" id="actionButton"> <input class="smart-input" id=\'input\' readonly=\'[[readonly]]\' placeholder=\'[[placeholder]]\' type=\'[[type]]\' name=\'[[name]]\' disabled=\'[[disabled]]\' aria-label="[[placeholder]]" /></div><span class="smart-hidden smart-hint" id="span">[[hint]]</span><div id="dropDownButton" tabindex=-1 class="smart-drop-down-button" role="button" aria-label="Toggle popup"><div id="arrow" class="arrow" aria-hidden="true"></div></div></div>'}_downHandler(e){const t=this,o=e.originalEvent.target;t.readonly&&o&&o.classList&&!o.classList.contains("smart-drop-down-list-unselect-button")?t._dropDownButtonDownHandler(e):t._tokenCloseButtonClick!==o.closest(".smart-drop-down-list-unselect-button")&&(t._tokenCloseButtonClick=o.closest(".smart-drop-down-list-unselect-button"),t.readonly&&!t._tokenCloseButtonClick&&t._dropDownButtonDownHandler(e))}focus(){const e=this;e.readonly?HTMLElement.prototype.focus.apply(e,[]):e.$.input.focus()}_setFocusable(){const e=this;if(e.readonly){if(e.disabled||e.unfocusable)return void e.removeAttribute("tabindex");e.tabIndex=e.tabIndex>0?e.tabIndex:0,e.$.listen("keydown",e._keyDownHandler),e.$.listen("keyup",e._keyUpHandler)}}_documentUpHandler(e){const t=this,o=t.shadowRoot||t.isInShadowDOM?e.originalEvent.composedPath()[0]:e.originalEvent.target;if(o!==t&&o!==t.$.dropDownButton&&o!==t.$.input&&o!==t.$.arrow){if(t._tokenCloseButtonClick&&t._tokenCloseButtonClick===o.closest(".smart-drop-down-list-unselect-button")){const e=o.closest(".smart-token"),[n,l]=[e.getAttribute("data-label"),e.getAttribute("value")];let s,a,i=t._selectedItems.findIndex((e=>n===e.label&&l===e.value)),[r,d]=[t.value,t.$.input.dataValue];return-1===i&&n===l&&(i=t._selectedItems.findIndex((e=>n===e))),i>-1&&t._selectedItems.splice(i,1),t.set("value",a=t._selectedItems.map((e=>e.label)).join(t.separator)),t.$.input.dataValue=s=t._selectedItems.map((e=>e.value)).join(t.separator),t._updateValue(),t.$.actionButton.contains(e)&&t.$.actionButton.removeChild(e),t.close(),void(a===r&&s===d||(t.$.fireEvent("change",{value:s,label:a,oldValue:d,oldLabel:r}),t._updateTargetValue()))}if(!t.contains(o))if(t.$.dropDownContainer.contains(o.shadowParent||o)){if(t._isPointerDown){if(t._isPointerDown=!1,t.opened&&(t._preventLookup=!0),o.hasAttribute("add-new"))return;t.focus()}}else t.opened&&(t._preventLookup=!0),t._isPointerDown||t.close(),t._isPointerDown=!1}else t._isPointerDown=!1}get selectedItems(){return this._selectedItems?this._selectedItems:[]}set selectedItems(e){this._selectedItems=e,this._updateValue()}_performSelect(e,t){const o=this;if(!e)return void o.close();const n=e.target?e.target.closest("li"):e;if(!n)return;o._selectedItems||(o._selectedItems=[]),n.classList.toggle("selected"),o.singleSelect&&(o._selectedItems=[],n.classList.add("selected"));const l=n.classList.contains("selected"),s={label:n.getAttribute("data-label"),value:n.getAttribute("value"),color:n.getAttribute("color"),image:n.getAttribute("image")},a=o.$.menu.children;for(let e=0;e<a.length;e++)o.singleSelect&&a[e]!==n&&a[e].classList.remove("selected"),a[e].classList.remove("active"),a[e].setAttribute("aria-selected",!1);if(l){if(o.dataSource&&o.dataSource[0]&&"string"==typeof o.dataSource[0])o._selectedItems.push(s);else{const e=o.dataSource.findIndex((e=>e.label===s.label&&""+e.value===s.value));o.dataSource&&e>=0?o._selectedItems.push(o.dataSource[e]):o._selectedItems.push(s)}if(e.noActiveState||(o._setActiveDescendant(n),n.classList.add("active")),o.dataSource)if(o.dataSource[0]&&"string"==typeof o.dataSource[0]){const e=o.dataSource.findIndex((e=>e===s.label));o.set("selectedIndex",e)}else{const e=o.dataSource.findIndex((e=>e.label===s.label&&""+e.value===s.value));o.set("selectedIndex",e)}}else{if(o.dataSource&&o.dataSource[0]&&"string"==typeof o.dataSource[0]){const e=o.dataSource.findIndex((e=>e===s.label));if(e>-1){const e=o._selectedItems.findIndex((e=>e===s.label));o._selectedItems.splice(e,1),o.set("selectedIndex",-1)}else o.set("selectedIndex",e)}else{const e=o.dataSource.findIndex((e=>e.label===s.label&&""+e.value===s.value));if(o.dataSource)if(e>-1){const e=o._selectedItems.findIndex((e=>e.label===s.label&&""+e.value===s.value));o._selectedItems.splice(e,1),o.set("selectedIndex",-1)}else o.set("selectedIndex",e)}n.classList.remove("active")}n.setAttribute("aria-selected",l),o._updateValue(t),o.singleSelect&&o.close()}_updateValue(e){const t=this;if(!t.isInitialized)return;let o=t._selectedItems,n=t.value,l=t.$.input.dataValue,[s,a]=[[],[]];o||(o=[]);for(let e=0;e<o.length;e++){const t=o[e];t?"string"==typeof t?(s.push(t),a.push(t)):(s.push(t.label),a.push(t.value)):(s.push(""),a.push(""))}t._createTags();let i=[];for(let e=0;e<o.length;e++){const t=o[e];"string"==typeof t?i.push(t):void 0!==t.value&&i.push(t.value)}if(t.set("selectedValues",i),s=s.join(t.separator),t.set("value",s),t.$.input.dataValue=a=a.join(t.separator),t.$.input.value="",t.setAttribute("value",t.value),e||s===n&&a===l||(t.$.fireEvent("change",{value:a,label:s,oldValue:l,oldLabel:n}),t._updateTargetValue()),t.selectAll&&t._setSelectAllItemState(),!t.opened)return;const r=t.getBoundingClientRect(),d=window.scrollX,c=window.scrollY;t.$.dropDownContainer.style.left=-3+r.left+d+"px",t.$.dropDownContainer.style.top=r.bottom+c+1+"px",t._reposition()}_setSelection(){const e=this;super._setSelection(),e.singleSelect&&(e._selectedItems.length>0&&(e._selectedItems=[e._selectedItems[e._selectedItems.length-1]]),e.selectedValues.length>0&&(e.selectedValues=[e.selectedValues[e.selectedValues.length-1]])),this._createTags()}_createTags(){const e=this,t=e._selectedItems||[];let o,n=document.createDocumentFragment();const l=document.createElement("div");l.classList.add("smart-flex-wrap"),l.classList.add("smart-tokens-container"),n.appendChild(l);const s=e.$.actionButton.querySelector(".smart-tokens-container");if(s&&s.remove(),0===t.length&&"one"===e.inputTagsMode&&e.readonly){const n="one"===e.inputTagsMode?t.length>1?e.localize("tagLabel",{value:t.length,count:e.dataSource.length}):e.localize("tagLabelOne",{value:t.length,count:e.dataSource.length}):"";o=document.createElement("span"),o.classList.add("smart-token"),o.innerHTML="<span class='smart-drop-down-list-selection-label' role=\"presentation\">"+n+"</span>",l.appendChild(o)}for(let n=0;n<t.length;n++){const s=t[n];if("one"===e.inputTagsMode&&!o||"many"===e.inputTagsMode){let n="one"===e.inputTagsMode?t.length>1?e.localize("tagLabel",{value:t.length,count:e.dataSource.length}):e.localize("tagLabelOne",{value:t.length,count:e.dataSource.length}):"string"==typeof s?s:s.label;"many"===e.inputTagsMode&&void 0===n&&(n=""),o=document.createElement("span"),o.classList.add("smart-token");let a=null,i="";if(s.image&&"many"===e.inputTagsMode&&(a=document.createElement("span"),a.style.backgroundImage=`url('${s.image}')`,a.className="smart-drop-down-list-selection-image",i=a.outerHTML),o.innerHTML=i+"<span class='smart-drop-down-list-selection-label' role=\"presentation\">"+n+"</span>",e.singleSelect||"one"===e.inputTagsMode||e.hideInputTagsCloseButton||(o.innerHTML+='<span class=\'smart-drop-down-list-unselect-button\' role="button" aria-label="Unselect"></span>'),"many"===e.inputTagsMode){s.label?(o.setAttribute("data-label",s.label),o.setAttribute("value",s.value)):"string"==typeof s&&s.length>0?(o.setAttribute("data-label",s),o.setAttribute("value",s)):(o.setAttribute("data-label",""),o.setAttribute("value","")),o.setAttribute("separator",e.separator);const t=s.color;if(t&&e.colorItems){o.setAttribute("color",t),o.style.setProperty("--smart-primary",t);const e=new Smart.Color(t).getInvertedColor();o.style.setProperty("--smart-primary-color",e)}}if(""===n&&e.singleSelect)continue;l.appendChild(o)}}e.$.actionButton.insertBefore(n,e.$.input);const a=e.getBoundingClientRect(),i=window.scrollX,r=window.scrollY;e.$.scrollView.style.left=-3+a.left+i+"px",e.$.scrollView.style.top=a.bottom+r+1+"px"}_render(e){const t=this,o=(e,o)=>{let n=e,l=e,s=e,a=null;"object"==typeof e&&(n=e.label,l=void 0!==e.value?e.value:n,a=void 0!==e.color?e.color:"",s=void 0!==e.id?e.id:o);const i=document.createElement("li"),r=document.createElement("a");if(r.href="javascript:void(0)",i.id=t.id+"Item"+Math.floor(65536*(1+Math.random())).toString(16).substring(1),i.setAttribute("data-label",n),i.setAttribute("value",l),i.setAttribute("role","option"),i.setAttribute("aria-selected",!1),i.setAttribute("aria-label",n),void 0!==s&&(i.id=s),a&&t.colorItems){i.setAttribute("color",a),i.style.setProperty("--smart-primary",a);const e=new Smart.Color(a).getInvertedColor();i.style.setProperty("--smart-primary-color",e)}if(r.innerHTML=t.highlighter?t.highlighter(n):t._highlighter(n),n||r.classList.add("smart-visibility-hidden"),r.setAttribute("aria-hidden",!0),e.icon&&(r.classList.add("icon"),r.classList.add(e.icon)),e.image){const t=document.createElement("span");t.style.backgroundImage=`url('${e.image}')`,t.className="smart-drop-down-list-selection-image",i.setAttribute("image",e.image),r.innerHTML=t.outerHTML+r.innerHTML}if(i.appendChild(r),t.allowItemsRemove){const o=document.createElement("span");o.classList.add("close-button"),e.image||(r.innerHTML="<span data-content>"+r.innerHTML+"</span>"),r.appendChild(o),o.onpointerdown=o=>{o.preventDefault(),o.stopPropagation();const s=t.dataSource.findIndex((t=>t.value===e.value));if(s>=0){if(t.dataSource.splice(s,1),i.remove(),t.$.scrollView.refresh&&t.$.scrollView.refresh(),"one"===t.inputTagsMode){const e=t._selectedItems.findIndex((e=>e.label===n&&e.value===l));e>=0&&t._selectedItems.splice(e,1),t._createTags()}t.$.fireEvent("remove",{index:s,label:e.label,value:e.value})}}}return(t.singleSelect&&""===e||t.singleSelect&&e&&""===e.label)&&(i.innerHTML=""),i},n=e.map((function(e,t){return o(e,t)}));t.$.menu.innerHTML="",0===n.length&&t.dropDownPlaceholder&&(t.$.menu.innerHTML='<div class="smart-flex smart-truncate smart-quiet" style="padding:10px; align-items: center;">'+t.dropDownPlaceholder+"</div>"),t._selectedItems||(t._selectedItems=[]);let l=t._selectedItems.map((e=>"string"==typeof e?e:e.value));l.length||(l=(t.$.input.dataValue||t.$.input.value).split(t.separator).map((e=>e.trim())));let s=Array.from(t.$.actionButton.getElementsByClassName("smart-token")).map((e=>e.textContent.trim()));if(t.allowItemsAdd){const e=document.createElement("div"),n=document.createElement("smart-button"),l=document.createElement("input");e.classList.add("add-new-item"),n.setAttribute("add-new",""),l.setAttribute("add-new",""),l.placeholder=t.localize("newItem"),l.classList.add("smart-input"),n.onclick=()=>{if(!l.value)return;const e={label:l.value,value:l.value.trim().replace(/ /gi,"")};t.dataSource||(t.dataSource=[]),t.dataSource.push(e);const n=o(e,t.dataSource.length-1);t.$.menu.appendChild(n),t.$.scrollView.refresh&&t.$.scrollView.refresh(),l.value="","one"===t.inputTagsMode&&t._createTags(),t.$.fireEvent("add",{label:e.label,value:e.value,index:t.dataSource.length-1})},l.onkeydown=e=>{"Enter"===e.key&&n.click()},e.appendChild(l),e.appendChild(n),t.$.menu.appendChild(e),t.$.menu.setAttribute("allow-add-new","")}for(let e=0;e<n.length;e++){const o=n[e],a=o.getAttribute("value"),i=o.getAttribute("data-label"),r=l.findIndex((e=>""+e==""+a));r>-1&&("one"===t.inputTagsMode||s[r]===i)&&(o.classList.add("selected"),o.setAttribute("aria-selected",!0),t._setActiveDescendant(o),t._selectedItems.findIndex((e=>"string"==typeof e?e===i:e.label===i&&e.value===a))<0&&t._selectedItems.findIndex((e=>"string"==typeof e?e===a:""+e.value==""+a))<0&&t._selectedItems.push({label:o.getAttribute("data-label"),value:o.getAttribute("value")})),t._setSelectAllItemState(),t.$.menu.appendChild(o)}}_next(){const e=this;let t=e._selectedItems?e._selectedItems[e._selectedItems.length-1]:void 0;t&&(t=e.$.menu.querySelector(`.active[data-label="${t.label}"][value="${t.value}"]`));const o=t||e.$.menu.querySelector(".active");if(!o){const t=e.$.menu.firstElementChild;return t.classList.add("active","focused"),void e._setActiveDescendant(t)}const n=e.$.menu.children;for(let e=0;e<n.length;e++)n[e].classList.remove("active","focused");e._setActiveDescendant();let l=o.nextElementSibling;l||(l=e.$.menu.firstElementChild),l.classList.add("active","focused"),e._setActiveDescendant(l),e.ensureVisible()}_prev(){const e=this;let t=e._selectedItems?e._selectedItems[e._selectedItems.length-1]:void 0;t&&(t=e.$.menu.querySelector(`.active[data-label="${t.label}"][value="${t.value}"]`));const o=t||e.$.menu.querySelector(".active");if(!o){const t=e.$.menu.firstElementChild;return t.classList.add("active","focused"),void e._setActiveDescendant(t)}const n=e.$.menu.children;for(let e=0;e<n.length;e++)n[e].classList.remove("active","focused");e._setActiveDescendant();let l=o.previousElementSibling;l||(l=e.$.menu.lastElementChild),l.classList.add("active","focused"),e._setActiveDescendant(l),e.ensureVisible()}_keyDownHandler(e){const t=this;if(t._suppressKeyPressRepeat=![40,38,9,13,27,16,17,18].includes(e.keyCode),e.shiftKey||e.altKey||e.ctrlKey)delete t._inputValue;else{if(t.opened&&"Escape"===e.key)return t.close(),e.stopPropagation(),void e.preventDefault();t._move(e),t._inputValue=t.$.input.value}}_keyUpHandler(e){const t=this;let o=t.$.input.value;if(t._selectedItems&&(o=t._selectedItems.map((e=>"string"==typeof e?e:e.label)),t.$.input.value&&o.push(t.$.input.value),o=o.join(t.separator)),t.set("value",o),!e.shiftKey&&"F2"!==e.key)if(","!==e.key){switch(e.keyCode){case 40:case 38:case 16:case 17:case 18:40===e.keyCode&&e.altKey&&t.open(),38===e.keyCode&&e.altKey&&t.close();break;case 8:{if(t.readonly)break;if(t.opened&&t.close(),t._inputValue&&t._inputValue.length)break;if(!t._selectedItems){t.readonly||(t.$.input.dataValue=t.$.input.value);break}const e=t._selectedItems[t._selectedItems.length-1];if(!e)break;(t.$.menu.querySelector(`li[data-label="${e.label}"][value="${e.value}"]`)||0===t.$.menu.offsetHeight)&&(t._selectedItems.pop(),t._updateValue());break}case 9:case 13:if(!t.opened)return void(t.autoAddNewTags&&13===e.keyCode&&"many"===t.inputTagsMode&&t._autoCreateTags());t._performSelect(t.$.menu.querySelector(".active")),e.stopPropagation(),e.preventDefault();break;case 27:if(!t.opened)return;t.close(),e.stopPropagation(),e.preventDefault();break;default:t._lookup(e),!t.opened||e.ctrlKey||e.shiftKey||(e.stopPropagation(),e.preventDefault())}delete t._inputValue}else t._autoCreateTags()}_blurHandler(){super._blurHandler(),this._autoCreateTags()}_autoCreateTags(){const e=this;if(!e.autoAddNewTags||"many"===!e.inputTagsMode)return;e.dataSource||(e.dataSource=[]);const t=e.$.input.value.trim();if(!e.dataSource.find((e=>"string"==typeof e?e===t:e.label===t))){e._tempItems||(e._tempItems=[]);let o=t.trim();if(t.indexOf(",")>=0){o=t.split(",");for(let t=0;t<o.length;t++){const n=o[t].trim();""!==n&&(e._tempItems.push(n),e._createTagsFromValue(n))}}else""!==o&&(e._tempItems.push(o),e._createTagsFromValue(o));e.query="",e._updateValue(!0)}}propertyChangedHandler(e,t,o){const n=this;if("disabled"===e&&n._setFocusable(),"value"===e){n.displayMember!==n.valueMember&&"string"!=typeof o?(n.value=o[n.displayMember],n.$.input.dataValue=o[n.valueMember]):n.$.input.dataValue="";const e=n.$.menu.children;for(let t=0;t<e.length;t++)e[t].classList.remove("selected"),e[t].setAttribute("aria-selected",!1);n._setActiveDescendant(n.$.menu.querySelector("active")),n._createTagsFromValue(o)}else if("separator"===e){const e=n.$.actionButton.children;for(let t=0;t<e.length;t++){const n=e[t];n.classList.contains("smart-token")&&n.setAttribute("separator",o)}}else if("inputTagsMode"===e)n._createTags();else if("theme"===e||"rightToLeft"===e)n.$.scrollView[e]=o,o?n.$.dropDownContainer.setAttribute(Smart.Utilities.Core.toDash(e),""):n.$.dropDownContainer.removeAttribute(Smart.Utilities.Core.toDash(e));else if("inverted"===e)o?n.$.dropDownContainer.setAttribute("inverted",""):n.$.dropDownContainer.removeAttribute("inverted");else if("selectAll"===e)n._handleSelectAllItem();else if("selectedIndex"===e){if(super.propertyChangedHandler(e,t,o),n._selectedItems=[],n.dataSource){const e=n.dataSource[o];e&&n._selectedItems.push(e),n._updateValue(!0)}}else if("selectedValues"===e){if(super.propertyChangedHandler(e,t,o),n.dataSource){n._selectedItems=[];const e=n.dataSource.filter((e=>{if("string"==typeof e){if(n.selectedValues.indexOf(e)>=0)return!0}else if(n.selectedValues.indexOf(e.value)>=0)return!0}));n._selectedItems=e,n._updateValue(!0)}}else super.propertyChangedHandler(e,t,o)}_createElement(){const e=this,t=document.createElement("ul"),o=document.createElement("smart-scroll-viewer"),n=document.createElement("div");if(o.rightToLeft=e.rightToLeft,o.theme=e.theme,o.horizontalScrollBarVisibility="hidden",o.classList.add("smart-multi-combo-input-scroll-viewer"),e.rightToLeft&&n.setAttribute("right-to-left",""),e.dataSource&&"string"==typeof e.dataSource&&(e.dataSource=e.$.deserialize(e.dataSource,"array")),n.setAttribute("theme",e.theme),n.classList.add("smart-multi-combo-input-drop-down-menu","smart-input-drop-down-menu","smart-check-input-drop-down-menu"),e.pills&&n.setAttribute("pills",""),e.singleSelect&&n.setAttribute("single-select",""),e.inverted?n.setAttribute("inverted",""):n.removeAttribute("inverted"),e.classList.add("smart-input"),n.appendChild(o),t.setAttribute("aria-multiselectable",!0),e.$.scrollView=o,e.$.menu=t,e.$.dropDownContainer=n,e.$.menu.onpointerdown=function(t){const o=t.target.closest("li");t.target&&t.target.hasAttribute("add-new")||(t.stopPropagation(),t.preventDefault(),e._performSelect(t),o&&e.$.fireEvent("itemClick",{index:[...o.parentNode.children].indexOf(o),item:o,label:o.getAttribute("aria-label"),value:o.dataValue}),e.focus())},e.classList.add("smart-input"),e.$.input.value="",e.selectedValues&&e.selectedValues.length>0){const t=e.dataSource.filter((t=>{if("string"==typeof t){if(e.selectedValues.indexOf(t)>=0)return!0}else if(e.selectedValues.indexOf(t.value)>=0)return!0}));e.selectedItems=t}else{const t=e.value;t&&e._createTagsFromValue(t)}e.readonly?e.$.input.classList.add("smart-hidden"):e.$.input.classList.remove("smart-hidden"),e._handleSelectAllItem(),e._setFocusable()}_createTagsFromValue(e=""){const t=this;if(e){const e=t.value.split(",");for(t.$.input.value="",t._selectedItems=[];"SPAN"===t.$.actionButton.firstElementChild.nodeName;)t.$.actionButton.removeChild(t.$.actionButton.firstElementChild);for(let o=0,n=e.length;o<n;o+=1){const n=e[o].trim();if(n)if(t.dataSource){const e=t.dataSource.find((e=>{if("string"==typeof e){if(e===n)return e}else if(""+e.value===n)return e}));e&&e.label?e.color?t._selectedItems.push({color:e.color,label:e.label,value:e.value}):t._selectedItems.push({label:e.label,value:e.value}):t._selectedItems.push({label:n,value:n})}else t._selectedItems.push({label:n,value:n})}t._createTags()}else t.$.input.value="",t._selectedItems=[],t._createTags()}_handleSelectAllItem(){const e=this;if(e.selectAll){if(!e.$.selectAll){const t=document.createElement("ul"),o=document.createElement("li"),n=document.createElement("a");n.href="#",n.innerHTML=e.localize("selectAll"),n.setAttribute("aria-hidden",!0),o.id=e.id+"Item"+Math.floor(65536*(1+Math.random())).toString(16).substring(1),o.setAttribute("role","option"),o.setAttribute("value",e.localize("selectAll")),o.setAttribute("aria-label",e.localize("selectAll")),o.classList.add("smart-select-all"),o.appendChild(n),o.onclick=function(t){t.stopPropagation(),t.preventDefault(),Array.from(e.$.menu.children).find((e=>!e.classList.contains("selected")))?e._selectAll():e._clearSelection(),e._setSelectAllItemState(),o.classList.contains("selected")&&o.classList.add("active"),e.focus()},t.appendChild(o),e.$.selectAll=t}e._setSelectAllItemState(),e.$.dropDownContainer.insertBefore(e.$.selectAll,e.$.scrollView)}else e.$.selectAll&&e.$.selectAll.remove()}_setSelectAllItemState(){const e=this;if(!e.$.selectAll)return;const t=e.$.selectAll.firstElementChild,o=t.firstElementChild,n=!Array.from(e.$.menu.children).find((e=>!e.classList.contains("selected")));t.removeAttribute("indeterminate"),t.classList.remove("selected","active"),o.innerHTML=e.localize("selectAll"),e._selectedItems&&e._selectedItems.length>0&&(n?(t.classList.add("selected"),o.innerHTML=e.localize("unselectAll")):t.setAttribute("indeterminate",""))}_selectAll(){const e=this,t=e._selectedItems.length,o=e.$.input.dataValue,n=e.value;e._clearSelection(!0);const l=e.$.menu.children;for(let t=0;t<l.length;t++)l[t].classList.contains("selected")||e._performSelect({target:l[t],noActiveState:!0},!0);t!==e._selectedItems.length&&(e.$.fireEvent("change",{value:e.$.input.dataValue,label:e.value,oldValue:o,oldLabel:n}),e._updateTargetValue())}_clearSelection(e){const t=this;if(!t._selectedItems.length)return;const o=t.$.input.dataValue,n=t.value;for(t.$.input.dataValue="",t.value=t.$.input.value,t._selectedItems=[];"SPAN"===t.$.actionButton.firstElementChild.nodeName;)t.$.actionButton.removeChild(t.$.actionButton.firstElementChild);const l=t.$.menu.children;for(let e=0;e<l.length;e++)l[e].classList.remove("selected"),l[e].classList.remove("active"),l[e].setAttribute("aria-selected",!1);t._setActiveDescendant(t.$.menu.querySelector("active")),e||(t.$.fireEvent("change",{value:"",label:"",oldValue:o,oldLabel:n}),t._updateTargetValue());const s=t.getBoundingClientRect(),a=window.scrollX,i=window.scrollY;t.$.dropDownContainer.style.left=-3+s.left+a+"px",t.$.dropDownContainer.style.top=s.bottom+i+1+"px",t._reposition()}_reposition(){const e=this,t=e.getBoundingClientRect();e.getBoundingClientRect();let o=0,n=0;if("static"!==getComputedStyle(document.body).position){const e=document.body.getBoundingClientRect();o=e.left,n=e.top}if(!e.opening){const l=window.scrollX,s=window.scrollY;e.$.dropDownContainer.style.left=-3+t.left+l-o+"px","bottom"===e.dropDownOpenPosition?e.$.dropDownContainer.style.top=t.bottom+s-n+1+"px":"top"===e.dropDownOpenPosition?e.$.dropDownContainer.style.top=t.top-e.$.dropDownContainer.offsetHeight+s-n+1+"px":"auto"===e.dropDownOpenPosition&&(e.$.dropDownContainer.removeAttribute("top"),e.$.dropDownContainer.style.top=t.bottom+s-n+1+"px",window.innerHeight<parseInt(e.$.dropDownContainer.style.top)+e.$.dropDownContainer.offsetHeight-s?(e.$.dropDownContainer.style.top=t.top-e.$.dropDownContainer.offsetHeight+s-n+1+"px",e.$.dropDownContainer.setAttribute("top","")):e.$.dropDownContainer.style.top=t.bottom+s-n+1+"px")}}_open(){const e=this;let t=e.getBoundingClientRect(),o=window.scrollX,n=window.scrollY,l=0,s=0;if(!this.opened&&!e._preventOpen){if(e.timer&&clearTimeout(e.timer),e.$.scrollView.classList.remove("smart-input-drop-down-menu"),e.$.dropDownContainer.id=e.id+"_"+e.tagName.toLowerCase()+"_menu_"+Math.floor(65536*(1+Math.random())).toString(16).substring(1),document.body.appendChild(e.$.dropDownContainer),e.setAttribute("aria-owns",e.$.dropDownContainer.id),e.readonly||e.$.input.setAttribute("aria-controls",e.$.dropDownContainer.id),e.$.scrollView.enableShadowDOM&&!e._importedStyle&&(e.$.scrollView.importStyle(e._getStyleUrl("smart.textbox.css")),e._importedStyle=!0),"static"!==getComputedStyle(document.body).position){const e=document.body.getBoundingClientRect();l=e.left,s=e.top}if(e.$.dropDownContainer.style.setProperty("--smart-input-drop-down-menu-width",""),e.$.dropDownContainer.style.left=-3+t.left+o-l+"px",e.$.dropDownContainer.style.top=t.bottom+n-s+1+"px",e.$.dropDownContainer.classList.remove("open"),"bottom"===e.dropDownOpenPosition)e.$.dropDownContainer.style.top=t.bottom+n-s+1+"px";else if("top"===e.dropDownOpenPosition)e.$.dropDownContainer.style.top=t.top-e.$.dropDownContainer.offsetHeight+n-s-2+"px",e.$.dropDownContainer.setAttribute("top","");else if("auto"===e.dropDownOpenPosition)if(e.$.dropDownContainer.removeAttribute("top"),window.innerHeight<parseInt(e.$.dropDownContainer.style.top)+e.$.dropDownContainer.offsetHeight-n+16){const o=t.top-e.$.dropDownContainer.offsetHeight+n-s-2;o>=0&&(e.$.dropDownContainer.style.top=o+"px",e.$.dropDownContainer.setAttribute("top",""))}else e.$.dropDownContainer.style.top=t.bottom+n-s+1+"px";e._positionTimer&&clearInterval(e._positionTimer),e.dropDownAppendTo||(e._positionTimer=setInterval((()=>{const o=e.getBoundingClientRect();if(e.opening)e.opening=!1,t=o;else if(Math.abs(parseInt(o.top)-parseInt(t.top))>=10||Math.abs(parseInt(o.left)-parseInt(t.left))>=10){const t=window.scrollX,n=window.scrollY;return e.$.dropDownContainer.style.left=-3+o.left+t-l+"px",void("bottom"===e.dropDownOpenPosition?e.$.dropDownContainer.style.top=o.bottom+n-s+1+"px":"top"===e.dropDownOpenPosition?e.$.dropDownContainer.style.top=o.top-e.$.dropDownContainer.offsetHeight+n-s+1+"px":"auto"===e.dropDownOpenPosition&&(e.$.dropDownContainer.removeAttribute("top"),e.$.dropDownContainer.style.top=o.bottom+n-s+1+"px",window.innerHeight<parseInt(e.$.dropDownContainer.style.top)+e.$.dropDownContainer.offsetHeight-n?(e.$.dropDownContainer.style.top=o.top-e.$.dropDownContainer.offsetHeight+n-s+1+"px",e.$.dropDownContainer.setAttribute("top","")):e.$.dropDownContainer.style.top=o.bottom+n-s+1+"px"))}}),50)),e.$.dropDownContainer.onpointerdown=function(){e._isPointerDown=!0},requestAnimationFrame((function(){const t=e.dropDownWidth;if(e.$.scrollView.refresh&&e.$.scrollView.refresh(),e._refreshMenu(),e.$.dropDownContainer.setAttribute("open",""),e.setAttribute("open",""),e.$.dropDownButton.setAttribute("open",""),e.$.input.setAttribute("open",""),t&&"string"==typeof t&&-1!==t.indexOf("%")){const o=parseFloat(t)/100;e.$.dropDownContainer.style.setProperty("--smart-input-drop-down-menu-width",e.offsetWidth*o+"px")}else if("auto"!==t&&t)e.$.dropDownContainer.style.setProperty("--smart-input-drop-down-menu-width",parseFloat(t)+"px");else if("auto"===t){if(e.$.dropDownContainer.style.setProperty("--smart-input-drop-down-menu-width",""),e.$.scrollView.$.scrollViewerContainer.classList.contains("vscroll")){const t=e.$.scrollView.offsetWidth+parseFloat(getComputedStyle(e.$.scrollView).getPropertyValue("--smart-scroll-bar-size"));e.$.dropDownContainer.style.setProperty("--smart-input-drop-down-menu-width",t+"px")}}else{e.$.menu.style.width="auto";let t=e.$.menu.offsetWidth;const o=e.$.menu.querySelectorAll("li");for(let t=0;t<o.length;t++)e._maxDropDownWidth=Math.max((o[t].firstElementChild||o[t]).offsetWidth,e._maxDropDownWidth);e.$.scrollView.computedVerticalScrollBarVisibility&&(t+=e.$.scrollView.$&&e.$.scrollView.$.verticalScrollBar?e.$.scrollView.$.verticalScrollBar.offsetWidth:30),e.$.dropDownContainer.style.setProperty("--smart-input-drop-down-menu-width",Math.max(t,e.offsetWidth-8)+"px"),e.$.menu.style.width=""}(e.shadowRoot||e.isInShadowDOM)&&e.$.scrollView._scrollView&&Smart.ScrollBar&&requestAnimationFrame((()=>e.$.scrollView._scrollView.vScrollBar.refresh()))})),e.$.scrollView.refresh&&e.$.scrollView.refresh(),e._refreshMenu(),e.allowItemsAdd&&setTimeout((()=>{e.$.scrollView.querySelector("input").focus()}),100),this.opened=!0,e.setAttribute("aria-expanded",!0)}}close(){const e=this;return!!e.opened&&(e.timer&&clearTimeout(e.timer),e._positionTimer&&clearInterval(e._positionTimer),e.timer=setTimeout((function(){e.$.dropDownContainer.parentNode&&!e.opened&&(document.body.removeChild(e.$.dropDownContainer),e.removeAttribute("aria-owns"),e.readonly||e.$.input.removeAttribute("aria-controls"))}),1e3),e.$.dropDownContainer.removeAttribute("open"),e.$.dropDownButton.removeAttribute("open"),e.$.input.removeAttribute("open"),e.removeAttribute("open"),e.opened=!1,e.setAttribute("aria-expanded",!1),e.focus(),e.$.fireEvent("close"),!0)}});