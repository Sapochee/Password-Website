
/* Smart UI v19.0.8 (2024-04-29) 
Copyright (c) 2011-2023 jQWidgets. 
License: https://htmlelements.com/license/ */ //

(()=>{Smart("smart-text-area",class extends Smart.Input{static get properties(){return{users:{value:[],type:"array",reflectToAttribute:!1},resize:{value:"none",type:"string"},richText:{value:!1,type:"boolean"},enableHTMLEncode:{value:!0,type:"boolean"},minWidth:{value:0,type:"number"},minHeight:{value:0,type:"number"},toolbarOnFocus:{value:!1,type:"boolean"},uploadSettings:{value:{url:{value:"",type:"string",reflectToAttribute:!1},removeUrl:{value:"",type:"string",reflectToAttribute:!1},existsUrl:{value:"",type:"string",reflectToAttribute:!1},name:{value:"userfile[]",type:"string",reflectToAttribute:!1},uploadMaxCount:{value:5,type:"number",reflectToAttribute:!1},uploadMaxSize:{value:2097152,type:"number",reflectToAttribute:!1},data:{value:null,type:"object",reflectToAttribute:!1},onUploadStarted:{value:null,type:"any",reflectToAttribute:!1},onUploadCompleted:{value:null,type:"any",reflectToAttribute:!1},onUploadRemove:{value:null,type:"any",reflectToAttribute:!1},onUploadError:{value:null,type:"any",reflectToAttribute:!1},onChange:{value:null,type:"any",reflectToAttribute:!1},onProgress:{value:null,type:"any",reflectToAttribute:!1},onAbort:{value:null,type:"any",reflectToAttribute:!1},onError:{value:null,type:"any",reflectToAttribute:!1},onSetHeaders:{value:null,type:"any",reflectToAttribute:!1}},reflectToAttribute:!1,type:"object"},toolbarItems:{value:["bold","italic","underline","strikethrough","alignment","orderedlist","unorderedlist","checklist","hyperlink","image","tableheader"],reflectToAttribute:!1,type:"array"}}}template(){return'<div id="inputContainer" role="presentation"><textarea class="smart-input" id=\'input\' readonly=\'[[readonly]]\' placeholder=\'[[placeholder]]\'  name=\'[[name]]\' value=\'{{value::keyup}}\' disabled=\'[[disabled]]\' aria-label="[[placeholder]]"></textarea><div id="editor"></div><span class="smart-hidden smart-hint" inner-h-t-m-l="[[hint]]" id="span"></span><div id="dropDownButton" tabindex=-1 class="smart-drop-down-button" role="button" aria-label="Toggle popup"><div id="arrow" class="arrow" aria-hidden="true"></div></div></div>'}_blurHandler(){const e=this;e.richText?e.removeAttribute("focus"):super._blurHandler()}_focusHandler(){const e=this;e.richText&&(e.$.editor.component.focus(),setTimeout((()=>{const t=e.$.editor.value;e.$.editor.selectionStart=t.length}))),super._focusHandler()}setHTML(e){const t=this;if(t.richText)return t.$.editor.value=e;this.value=e.replaceAll("<","&lt;").replaceAll(">","&gt;")}getHTML(){const e=this;return e.richText?e.$.editor.component.getHTML():e.value}propertyChangedHandler(e,t,o){const n=this;"value"===e&&n.richText&&(n.$.editor.value=o),"users"===e?(delete n._initMenu,n._mentionMenu&&(n._mentionPlugin&&n._mentionPlugin.destroy(),n._mentionMenu.remove(),n._initUsersMention()),n._renderMentionTrigger()):"resize"===e&&(n.richText?n.$.editor.querySelector(".smart-editor-editable").style.resize=o:n.$.input.style.resize=o,n._mentionTrigger&&("none"!==n.resize?n._mentionTrigger.style.right="10px":n._mentionTrigger.style.right="5px"))}detached(){const e=this;delete e._initMenu,e._mentionMenu&&e._mentionMenu.remove()}findMatches(){const e=this.$.input.value.split("").concat([" "]),t=[];let o="";for(let n in e){let i=e[n],r=e[n-1]||" ",s=[" ","\\n"].indexOf(r)>-1||10===r.charCodeAt(0);("@"===i&&s||o.length)&&" "!==i&&(o+=i),o.length&&" "===i&&(t.push({word:o,index:Math.max(n-o.length,0)}),o="")}return t}getMentions(){const e=this,t=this.findMatches(),o=[];return t.forEach((t=>{e.users.forEach((e=>{const n=t.word.replace("@","");e.name===n&&o.push(e)}))})),o}_initUsersMention(){const e=this;if(e._initMenu)return;e._initMenu=!0;const t=document.createElement("div");t.id=e.id+"_mention_menu",t.classList.add("smart-text-area-mention-menu","smart-hidden"),e._mentionMenu=t,document.body.appendChild(t),e._mentionPlugin=new Smart.Mention(e.richText?e.$.editor:e.$.input,t,(t=>""===t?e.users:e.users.filter((e=>e.name.startsWith(t)))),((e,t)=>e?`${t}${e.name} `:""),((e,t,o)=>{const n=document.createElement("div");return n.setAttribute("role","option"),n.className="smart-text-area-mention-menu-item",o&&(n.classList.add("selected"),n.setAttribute("aria-selected","")),n.textContent=e.name,n.onpointerdown=e=>{e.preventDefault(),t()},n}))}_initRichText(e,t,o){const n=this,i=n,r={};if(!e)return;o||(o={bold:"Bold",italic:"Italic",underline:"Underline",striketrhough:"Strikethrough",alignment:"Alignment",unorderedlist:"Bulleted list",orderedlist:"Numbered list",checklist:"Checklist",paragraph:"Paragraph",format:"Format",image:"Image",h1:"Large Heading",h2:"Medium Heading",h3:"Small Heading",link:"Create link",code:"Code",openLink:"Ctrl + Click to open the link"});const s=`\n            <div class="smart-container">\n                <div class="smart-editor-toolbar"> \n                    <div style="height: auto;" class="smart-editor-toolbar-items-primary">\n                        <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" tooltip="${o.bold}" command="bold" item-name="bold"></div>\n                        <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" tooltip="${o.italic}" command="italic" item-name="italic"></div>\n                        <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" tooltip="${o.underline}" command="underline" item-name="underline"></div>\n                        <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" tooltip="${o.striketrhough}" command="strikethrough" item-name="strikethrough"></div>\n                        <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center smart-arrow-down" item-type="button" item-value="left" item-name="alignment" command="justify" tooltip="${o.alignment}"></div>\n                        <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" tooltip="${o.unorderedlist}" command="insertUnorderedList" item-name="unorderedlist"></div>\n                        <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" tooltip="${o.orderedlist}" command="insertOrderedList" item-name="orderedlist"></div>\n                        <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" tooltip="${o.checklist}" command="insertUnorderedList" item-name="checklist"></div>\n                        <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" tooltip="${o.link}" command="hyperlink" item-name="hyperlink"></div>\n                        <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" tooltip="${o.image}" command="image" item-name="image"></div>\n                        <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center smart-arrow-down" item-type="button" item-name="tableheader" tooltip="${o.format}"></div>\n                    </div>\n                </div>\n            <div class="smart-editor-content-container">\n                <div class="smart-editor-editable" contenteditable="true"></div>\n            </div>\n        </div>\n        `,a=e;a.className="smart-editor smart-rich-textarea",a.style.borderLeftWidth=a.style.borderTopWidth=a.style.borderRightWidth=a.style.borderBottomWidth="0px",a.innerHTML=s;const l=a.querySelector(".smart-editor-editable");l.style.resize=n.resize,n.style.minHeight=n.minHeight+"px",l.style.minHeight=n.minHeight+"px",l.style.minWidth=n.minWidth+"px",e.style.minHeight=n.minHeight+"px",e.style.minWidth=n.minWidth+"px";const d=a.querySelectorAll(".smart-editor-toolbar-item");for(let e=0;e<d.length;e++){const t=d[e],o=t.getAttribute("item-name");-1===n.toolbarItems.indexOf(o)&&t.classList.add("smart-hidden")}if(r.textarea=t,r.tools=[],r.toolbar=a.querySelector(".smart-editor-toolbar"),n.toolbarOnFocus){r.toolbar.id=n.id+"_toolbar";const e=document.createElement("div");e.classList.add("smart-editor"),e.classList.add("smart-editor-toolbar-float"),e.setAttribute("focus",""),e.appendChild(r.toolbar),a.querySelector(".smart-container").setAttribute("toolbar-on-focus",""),n.appendChild(e)}r.contentContainer=a.querySelector(".smart-editor-content-container");const m=document.createElement("div");m.className="smart-editor-tooltip",m.setAttribute("tooltip-position","bottom"),document.body.appendChild(m),r.tooltip=document.querySelector(".smart-editor-tooltip");new ResizeObserver((()=>{if("none"!==n.resize){if(n.style.width=parseInt(l.offsetWidth)+2+"px",n.toolbarOnFocus)return void(n.style.height=parseInt(l.offsetHeight)+2+"px");n.style.height=parseInt(l.offsetHeight)+r.toolbar.offsetHeight+2+"px"}})).observe(l);const c=[],u=(e,t)=>{const o=this,n=new FormData,i=o.uploadSettings.url;let r=!1;const s=files[0],a=o.uploadSettings.data;a&&""!==a&&("string"==typeof a?n.append("postData",a):n.append("postData",JSON.stringify(a))),n.append("fileType",fileType);for(let e=0;e<files.length;e++)n.append(o.uploadSettings.name,files[e]),r=!0;let l=new XMLHttpRequest;l.open("POST",i),o.uploadSettings.onSetHeaders&&"function"==typeof o.uploadSettings.onSetHeaders&&o.uploadSettings.onSetHeaders(l,s),o.uploadSettings.onUploadStarted&&o.uploadSettings.onUploadStarted({files,status:l.status}),l.upload.onprogress=function(e){o.uploadSettings.onProgress&&o.uploadSettings.onProgress(e)},l.onabort=function(e){o.uploadSettings.onAbort&&o.uploadSettings.onAbort(e)},l.onerror=function(e){o.uploadSettings.onError&&o.uploadSettings.onError(e)},l.onload=function(){let e=!1;if(l.response&&("string"==typeof l.response?(e=l.response,e.indexOf("[{")>=0&&(e=JSON.parse(l.response))):e=JSON.parse(l.response)),l.status>=200&&l.status<=299){const n=(e,t)=>{if(e.response&&e.response.response&&"success"!==e.response.response)return null;let o=!1;l.fileURL&&(o=l.file_url);let n={};e&&e.file_url?o=e.file_url:e&&e[0]&&e[0].file_url&&(o=e[0].file_url);let i=!1;e&&e.file_url_small?i=e.file_url_small:e&&e[0]&&e[0].file_url_small&&(i=e[0].file_url_small);let r=!1;e&&e.file_url_medium?r=e.file_url_medium:e&&e[0]&&e[0].file_url_medium&&(r=e[0].file_url_medium);let s=!1;return e&&e.file_url_large?s=e.file_url_large:e&&e[0]&&e[0].file_url_large&&(s=e[0].file_url_large),o&&(n.value=o),i&&(n.small=i),r&&(n.medium=r),s&&(n.large=s),n.label=t,n};for(let t=0;t<files.length;t++){const i=files[t].name?[]:files[t].split("/"),r="url"===fileType?i[i.length-1]:files[t].name;o.uploadSettings.url;const s=n((e.files||e[0]&&e[0].files||[e[0]])[t],r);s&&c.push(s)}t(c,e)}else t(c,e)},l.onreadystatechange=function(){},r&&l.send(n)};d.forEach((t=>{const i=t.getAttribute("item-name");r.tools[i]={element:t,type:"button"},t.onmouseenter=e=>{setTimeout((()=>{const t=e.target.getAttribute("tooltip"),o=e.target.getBoundingClientRect(),i=(r.toolbar.getBoundingClientRect(),e=>e?e.offsetTop+i(e.offsetParent):0),s=e=>e?e.offsetLeft+s(e.offsetParent):0,a=(l=e.target,{left:s(l),top:i(l)});var l;r.tooltip.style.top=5+a.top+o.height+"px",r.tooltip.setAttribute("hover-tooltip",t),r.tooltip.classList.add("open"),r.tooltip.style.left=a.left+o.width/2-r.tooltip.offsetWidth/2+"px",n._tooltipTimer&&clearTimeout(n._tooltipTimer),n._tooltipTimer=setTimeout((()=>{r.tooltip.classList.remove("open")}),1e3)}),150)},t.onmouseleave=()=>{r.tooltip.classList.remove("open")},t.onpointerdown=t=>{const i=t.target.getAttribute("item-name"),s=(t.target.getAttribute("item-value"),t.target.getAttribute("command")),l=t.target.getAttribute("command-value"),d=a.querySelector(".smart-editor-editable"),m=e=>{if(!e||"tableheader"===e){const e=n.toolbarOnFocus?document.querySelector("#"+n.id+'_toolbar [item-name="tableheader"]'):a.querySelector('[item-name="tableheader"]');e._popup&&(e._popup.remove(),delete e._popup)}if(!e||"alignment"===e){const e=n.toolbarOnFocus?document.querySelector("#"+n.id+'_toolbar [item-name="alignment"]'):a.querySelector('[item-name="alignment"]');e._popup&&(e._popup.remove(),delete e._popup)}};if("tableheader"!==i)if("alignment"!==i){switch(m(),t.target.hasAttribute("checked")?t.target.removeAttribute("checked"):t.target.setAttribute("checked",""),i){case"bold":case"italic":case"underline":case"strikethrough":case"unorderedlist":case"checklist":case"orderedlist":d.getRootNode().execCommand(s,!1,null);break;case"image":{const t=document.createElement("input");t.type="file",t.accept="image/jpeg, image/png, image/gif",t.hidden=!0,document.body.appendChild(t);r._getSelectionRange();d.getRootNode().execCommand("insertHTML",!1,'<img style="max-width: 100%;" class="smart-hidden" id="targetImage"/>'),t.click(),t.onchange=()=>{const o=d.getRootNode().getElementById("targetImage"),i=t.files[0];o.id="",o.classList.add("smart-hidden");const r=new FileReader;r.addEventListener("load",(function(){o.src=r.result,o.classList.remove("smart-hidden")})),i&&r.readAsDataURL(i),n.uploadSettings.uploadUrl&&u(0,(t=>{t&&t.length&&(o.src=t[0].medium||t[0].value,o.classList.remove("smart-hidden"),e.imgArray||(e.imgArray=[]),e.imgArrayId||(e.imgArrayId=[]),e.imgArray.push(o.src),e.imgArrayId[o.src]=t[0])}))};break}case"hyperlink":{const e=r._getSelectionRange();let t,n=e.startContainer;n&&"a"!==n.nodeName.toLowerCase()&&(n=n.parentElement);let i=!1;n&&"a"===n.nodeName.toLowerCase()?(t=n.textContent,i=!0):t=e.toString(),i?(n.remove(),d.getRootNode().execCommand("insertHTML",!1,t)):t&&(d.getRootNode().execCommand("insertHTML",!1,'<a title="'+o.openLink+'" href="https://'+t.trim()+'">'+t+"</a>"),setTimeout((()=>{let e=r._getSelectionRange().startContainer;e&&"a"!==e.nodeName.toLowerCase()&&(e=e.parentElement),e&&"a"===e.nodeName.toLowerCase()&&(e.onmouseenter=t=>{t.ctrlKey&&e.classList.add("ctrl")},e.onmousemove=t=>{t.ctrlKey&&e.classList.add("ctrl")},e.onmouseleave=()=>{e.classList.remove("ctrl")})}),50));break}case"h1":case"h2":case"h3":case"p":case"pre":case"justify":case"formats":d.getRootNode().execCommand(s,!1,l)}if("checklist"===i){const e=window.getSelection();if(e.focusNode){const t=e.focusNode.parentElement.closest("ul");t&&t.setAttribute("checklist","")}}t.preventDefault()}else{t.preventDefault(),m("tableheader");const e=n.toolbarOnFocus?document.querySelector("#"+n.id+'_toolbar [item-name="alignment"]'):a.querySelector('[item-name="alignment"]');if(e._popup)e._popup.remove(),delete e._popup;else{e._popup=document.createElement("div");const t=e._popup;document.body.appendChild(t),t.style.position="absolute",t.style.height="auto",t.style.width="30px",t.style.background="var(--smart-background)",t.style.borderStyle="solid",t.style.borderWidth="1px",t.style.borderColor="var(--smart-border)",t.style.boxShadow="var(--smart-elevation-8)",t.style.zIndex=99999;const n=e.getBoundingClientRect();t.style.top=n.bottom+"px",t.style.left=n.left+"px",t.innerHTML=`\n                    <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" tooltip="${o.alignLeft}" command="justify" command-value="Left" item-name="alignment" item-value="left"></div>\n                    <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" tooltip="${o.alignCenter}" command="justify" command-value="Center" item-name="alignment" item-value="center"></div>\n                    <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" tooltip="${o.alignRight}" command="justify" command-value="Right" item-name="alignment" item-value="right"></div>\n                    <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" tooltip="${o.alignJustify}" command="justify" command-value="Full" item-name="alignment" item-value="justify"></div>\n                    `,t.querySelectorAll(".smart-button").forEach((t=>{t.onpointerdown=t=>{e._popup.remove(),delete e._popup;const o=t.target.getAttribute("command"),n=t.target.getAttribute("command-value");a.querySelector(".smart-editor-editable").getRootNode().execCommand(o+n,!1,null),t.preventDefault()}}))}}else{t.preventDefault(),m("alignment");const e=n.toolbarOnFocus?document.querySelector("#"+n.id+'_toolbar [item-name="tableheader"]'):a.querySelector('[item-name="tableheader"]');if(e._popup)e._popup.remove(),delete e._popup;else{e._popup=document.createElement("div");const t=e._popup;document.body.appendChild(t),t.style.position="absolute",t.style.height="auto",t.style.width="70px",t.style.background="var(--smart-background)",t.style.borderStyle="solid",t.style.borderWidth="1px",t.style.borderColor="var(--smart-border)",t.style.boxShadow="var(--smart-elevation-8)",t.style.zIndex=99999;const n=e.getBoundingClientRect();t.style.top=n.bottom+"px",t.style.left=n.left-20+"px",t.innerHTML=`\n                    <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" tooltip="${o.paragraph}" command="insertParagraph" command-value="p" item-name="p">P</div>\n                    <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" tooltip="${o.h1}" command="formatBlock" command-value="H1" item-name="h1">H1</div>\n                    <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" tooltip="${o.h2}" command="formatBlock" command-value="H2" item-name="h2">H2</div>\n                    <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" tooltip="${o.h3}" command="formatBlock" command-value="H3" item-name="h3">H3</div>\n                    <div class="smart-button smart-editor-toolbar-item smart-editor-toolbar-item-center" item-type="button" tooltip="${o.code}" command="formatBlock" command-value="pre" item-name="pre">Code</div>       \n                    `,t.querySelectorAll(".smart-button").forEach((t=>{t.onpointerdown=t=>{e._popup.remove(),delete e._popup;const o=t.target.getAttribute("command"),n=t.target.getAttribute("command-value");a.querySelector(".smart-editor-editable").getRootNode().execCommand(o,!1,n),t.preventDefault()}}))}}}}));const p=a.querySelector(".smart-editor-editable");r.content=p,r.content.innerHTML="<div>"+t.value+"&#8203;</div>";const h=(e,o)=>{const n=r;return void 0===e&&(e=t.value),e=!o&&n.enableHtmlEncode?e.replaceAll("<","&lt;").replaceAll(">","&gt;"):e.replaceAll("&lt;","<").replaceAll("&gt;",">")};e.component=r;const g=(e,t)=>{var o=t(e);for(e=e.firstChild;!1!==o&&e;e=e.nextSibling)o=g(e,t);return o};r.getCaretPosition=e=>{var t=window.getSelection(),o=[0,0];if(t.anchorNode===e)o=[t.anchorOffset,t.extentOffset];else{var n=[t.anchorNode,t.extentNode];if(!e.contains(t.anchorNode)||!e.contains(t.extentNode))return;var i,r=[0,0];g(e,(function(e){for(i=0;i<2;i++)if(e==n[i]&&(r[i]=!0,r[0==i?1:0]))return!1;if(e.textContent&&!e.firstChild)for(i=0;i<2;i++)r[i]||(o[i]+=e.textContent.length)})),o[0]+=t.anchorOffset,o[1]+=t.extentOffset}return o[0]<=o[1]?o:[o[1],o[0]]},r.setCaretPosition=e=>{if(e>=0){const t=window.getSelection(),o=(e,t,n)=>{if(n||((n=document.createRange()).selectNode(e),n.setStart(e,0)),0===t.count)n.setEnd(e,t.count);else if(e&&t.count>0)if(e.nodeType===Node.TEXT_NODE)e.textContent.length<t.count?t.count-=e.textContent.length:(n.setEnd(e,t.count),t.count=0);else for(var i=0;i<e.childNodes.length&&(n=o(e.childNodes[i],t,n),0!==t.count);i++);return n},n=o(a.querySelector(".smart-editor-editable"),{count:e});n&&(n.collapse(!1),t.removeAllRanges(),t.addRange(n))}},r.execCommand=(e,t)=>{const o=p.getRootNode();o&&o.execCommand(e,!1,t)},Object.defineProperty(e,"selectionStart",{configurable:!1,enumerable:!0,get(){t.value=r.content.textContent;const e=r.getCaretPosition(r.content);return void 0!==e?e[1]:0},set(e){r.setCaretPosition(e)}}),Object.defineProperty(e,"value",{configurable:!1,enumerable:!0,get:()=>(t.value=r.content.textContent,r._getInputValue()),set(e){r.content.innerHTML!==e&&(r.content.innerHTML="<div>"+e+"&#8203;</div>",t.value=e,i.set("value",t.value,!1),r.setCaretPosition(r.content.textContent.length-1))}});return r._getSelectionRange=()=>{const e=r;return e._selectionRange||e._setSelectionRange(),e._selectionRange},r._setSelectionRange=(e,t,o)=>{const n=r;let i=a.querySelector(".smart-editor-editable");const s=window.getSelection();let l;if(e){if(l=document.createRange(),"number"==typeof t&&"number"==typeof o)try{l.setStart(e,parseInt(t)),l.setEnd(e,parseInt(o))}catch(t){l.selectNodeContents(e)}else"img"===e.nodeName.toLowerCase()||e.classList.contains("smart-editor-video-container")?(l.setStartBefore(e),l.setEndAfter(e),l.selectNode(e)):l.selectNodeContents(e);s.removeAllRanges(),s.addRange(l)}else s.rangeCount&&(l=s.getRangeAt(0));try{l&&l.startContainer&&i.contains(l.startContainer)&&(r._selectionRange=l)}catch(e){}n._selectionRange||(l=document.createRange(),l.selectNodeContents(i),l.collapse(!0),r._selectionRange=l)},r._getNodeFromList=(e,t)=>{const o=r.content;if(e&&t)for(;e&&e!==o;){const o=e.nodeName.toLocaleLowerCase();if(t.indexOf(o)>-1)return o;e=e.parentElement}},r._setItemValue=(e,t)=>{const o=r;let n=t.value;e&&t&&("button"===t.type?n?(e.setAttribute("checked",""),e.setAttribute("aria-pressed",!0)):(e.removeAttribute("checked"),e.setAttribute("aria-pressed",!1)):(n||"color-input"!==t.type?["fontname","formats"].indexOf(t.name)>-1&&(n=o.localize(t.value)||t.label||t.value):n="transparent",n?(e.setAttribute("item-value",n),e.style.setProperty("--item-value",n)):(e.removeAttribute("item-value"),e.style.removeProperty("--item-value"))))},r._getInputValue=h,r._updateToolbarItems=e=>{const t=r,o=t._getSelectionRange();if(!o)return;const n=t.content;let i,s=o.startOffset>o.endOffset?o.endContainer:o.startContainer;if(s&&(s.closest||(s=s.parentElement),s&&s.closest)){e||(e=["alignment","bold","hyperlink","italic","strikethrough","underline","fontsize","fontname","formats","fontcolor","backgroundcolor","orderedlist","unorderedlist","image","checklist","subscript","superscript","h1","h2","h3","code","pre"]);for(let o=0,r=e.length;o<r;o+=1){const r=e[o],a=t.tools[r];if(a){let e;if("alignment"===r)e=s.style.textAlign;else if("bold"===r)e=!!t._getNodeFromList(s,["b","strong","h4","h5","h6"]);else if("hyperlink"===r)e=!!t._getNodeFromList(s,["a"]);else if("h1"===r)e=!!t._getNodeFromList(s,["h1"]);else if("h2"===r)e=!!t._getNodeFromList(s,["h2"]);else if("h3"===r)e=!!t._getNodeFromList(s,["h3"]);else if("pre"===r)e=!!t._getNodeFromList(s,["pre"]);else if("p"===r)e=!!t._getNodeFromList(s,["p"]);else if("italic"===r)e=!!t._getNodeFromList(s,["i"]);else if("underline"===r)e=!!t._getNodeFromList(s,["u"]);else if("strikethrough"===r)e=!!t._getNodeFromList(s,["strike"]);else if("fontsize"===r){const t=s.closest(".smart-editor-editable font");t&&(e=t.style.fontSize),e||(i||(i=window.getComputedStyle(s)),e=i.fontSize),e=parseInt(e),isNaN(e)&&(e="")}else if("fontname"===r){const t=s.closest(".smart-editor-editable font");t&&t.hasAttribute("face")?e=t.getAttribute("face"):(i||(i=window.getComputedStyle(s)),e=i.fontFamily.split(",")[0])}else if("formats"===r&&s!==n){const o=["h1","h2","h3","p","pre"];if(e="",o){const n=o;e=t._getNodeFromList(s,n)||""}}else if("fontcolor"===r){const t=s.closest(".smart-editor-editable font");t?e=t.color:(i||(i=window.getComputedStyle(s)),e=i.color)}else if("backgroundcolor"===r)e=t._getNodeBackgroundColor(s),e||(i||(i=window.getComputedStyle(s)),e=i.backgroundColor);else if("orderedlist"===r||"unorderedlist"===r){e=!!s.closest(`.smart-editor-editable ${"orderedlist"===r?"ol":"ul"} li`);const t=s.closest(`.smart-editor-editable ${"orderedlist"===r?"ol":"ul"} li`);t&&t.parentElement&&t.parentElement.hasAttribute("checklist")&&(e=!1)}else if("checklist"===r){const t=s.closest(`.smart-editor-editable ${"orderedlist"===r?"ol":"ul"} li`);t&&t.parentElement.hasAttribute("checklist")&&(e=!0)}else"subscript"===r?e=!!s.closest(".smart-editor-editable sub"):"superscript"===r&&(e=!!s.closest(".smart-editor-editable sup"));if(!e&&a.dataSource){const t=a.dataSource[0];t&&(e=t.value||t)}null!==e&&(a.value=e,t._setItemValue(t.toolbar.querySelector(`.smart-editor-toolbar-item[item-name=${r}]`),a))}}}},r._getTextFromCarret=()=>{const e=r._getSelectionRange(),t=e.startContainer,o=t.textContent;let n,i;if(!e.toString()&&o.length>0&&o.indexOf(" ")>-1){const t=o.slice(0,e.startOffset).lastIndexOf(" ")+1;let r=o.slice(e.endOffset).indexOf(" ");r<0&&(r=o.length-1),n=t>-1?t:e.startOffset,i=Math.max(e.endOffset,e.endOffset+r)}else n=0,i=t.length;return{selectionStartIndex:n,selectionEndIndex:i}},r.focus=()=>{p.focus()},r.blur=()=>{p.blur()},r.getHTML=()=>h(r.content.innerHTML),p.onpointerup=e=>{const t=r,o=e.target;if(t._setSelectionRange(),t._updateToolbarItems(),e.ctrlKey){let e=t._getSelectionRange().startContainer;e&&"a"!==e.nodeName.toLowerCase()&&(e=e.parentElement),e&&"a"===e.nodeName.toLowerCase()&&window.open(e.href,"_blank")}if(o&&"LI"===o.nodeName&&o.closest("UL[checklist]")){const e=t._getSelectionRange();e&&0===e.startOffset&&0===e.endOffset&&(o.hasAttribute("checked")?o.removeAttribute("checked"):o.setAttribute("checked",""))}},p.onpaste=()=>{const e=r;e._setSelectionRange(),e._updateToolbarItems(),t.value=e.content.textContent,i.set("value",t.value,!1)},p.oninput=e=>{const o=r;o._setSelectionRange(),o._updateToolbarItems();const n=t.value;t.value=o.content.textContent,i.set("value",t.value,!1),i.$.fireEvent("input",{value:t.value,oldValue:n,html:r.getHTML()}),e.stopPropagation()},p.onkeydown=e=>{const t=r;t._setSelectionRange(),t._updateToolbarItems();let o=r._getSelectionRange().startContainer;o&&"a"!==o.nodeName.toLowerCase()&&(o=o.parentElement),o&&"a"===o.nodeName.toLowerCase()&&e.ctrlKey&&o.classList.add("ctrl")},p.onkeyup=()=>{const e=r;e._setSelectionRange(),e._updateToolbarItems(),t.value=e.content.textContent,i.set("value",t.value,!1)},p.onfocus=()=>{a.setAttribute("focus",""),i.toolbarOnFocus&&r.toolbar.parentElement.classList.add("show")},p.onblur=()=>{const o=r;a.removeAttribute("focus");const n=t.value;t.value=o.content.textContent,i.set("value",t.value,!1),i.toolbarOnFocus&&r.toolbar.parentElement.classList.remove("show"),r.tooltip.classList.remove("open"),i.$.fireEvent("change",{value:t.value,oldValue:n,html:r.getHTML()}),o.content.querySelector("img")&&i.uploadSettings.uploadUrl&&i.uploadSettings.removeUrl&&o.content.querySelectorAll("img").forEach((t=>{if(e.imgArray&&-1===e.imgArray.indexOf(t.src)&&e.uploadSettings.removeUrl){let o=new FormData,n=new XMLHttpRequest;if(o.append(e.uploadSettings.name,t.src),e.imgArrayId[t.src]){const n=e.imgArrayId[t.src].small,i=e.imgArrayId[t.src].medium,r=e.imgArrayId[t.src].large,s=e.imgArrayId[t.src].value;n&&o.append(e.uploadSettings.name+"_small",n),i&&o.append(e.uploadSettings.name+"_medium",i),r&&o.append(e.uploadSettings.name+"_large",r),s&&o.append(e.uploadSettings.name+"_value",s)}n.open("POST",e.uploadSettings.removeUrl),n.send(o)}}))},document.addEventListener("selectionchange",(e=>{const t=r;if(!e.target.getSelection)return;const o=e.target.getSelection().focusNode;t.contentContainer.contains(o)&&(t._setSelectionRange(),t._updateToolbarItems())})),r}render(){const e=this;if(super.render(),e.richText)e._initRichText(e.$.editor,e.$.input);else{new ResizeObserver((()=>{"none"!==e.resize&&(e.style.width=parseInt(e.$.input.offsetWidth)+2+"px",e.style.height=parseInt(e.$.input.offsetHeight)+2+"px")})).observe(e.$.input),e.$.input.style.resize=e.resize}e._initUsersMention(),e._renderMentionTrigger(),e.classList.add("smart-input")}_renderMentionTrigger(){const e=this;if(!this.richText&&e.users&&e.users.length){e.setAttribute("has-users","");const t=document.createElement("span");t.innerHTML="@",t.style.position="absolute",t.classList.add("smart-hidden"),t.classList.add("smart-mention-trigger"),t.style.bottom="3px","none"!==e.resize?t.style.right="10px":t.style.right="5px",t.style.cursor="pointer",t.onpointerdown=t=>{const o=this.$.input.selectionEnd,n=this.$.input.value.slice(0,o),i=this.$.input.value.substring(o);return e.richText?(e.$.editor.component.execCommand("insertHTML","@"),this.$.editor.dispatchEvent(new Event("input")),void t.preventDefault()):n.length>1&&n.substring(n.length-2).indexOf("@")>=0?(this.$.input.dispatchEvent(new Event("input")),void t.preventDefault()):(n.length>0?(this.$.input.value=n+" @"+i,this.$.input.selectionStart=this.$.input.selectionEnd=o+2):0===e.$.input.selectionStart&&(this.$.input.value=n+"@ "+i,this.$.input.selectionStart=this.$.input.selectionEnd=1),this.$.input.dispatchEvent(new Event("input")),void t.preventDefault())},e._mentionTrigger=t,e.addEventListener("focus",(()=>{t.classList.remove("smart-hidden"),e._mentionPlugin&&e._mentionPlugin.refreshMenu()})),e.addEventListener("blur",(()=>{t.classList.add("smart-hidden"),e._mentionPlugin&&e._mentionPlugin.refreshMenu()})),e.onmouseenter=()=>{t.classList.remove("smart-hidden")},e.onmouseleave=()=>{t.classList.add("smart-hidden")},e.$.inputContainer.appendChild(t)}}});const e=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing","tabSize","MozTabSize"];function t(t,o){const n=document.createElement("div");document.body.appendChild(n);const i=n.style;let r=getComputedStyle(t);if(t.className.indexOf("smart-editor")>=0){const e=t.querySelector(".smart-editor-editable");r=getComputedStyle(e)}i.whiteSpace="pre-wrap",i.wordWrap="break-word",i.position="absolute",i.visibility="hidden",e.forEach((e=>{i[e]=r[e]})),i.overflow="hidden",n.textContent=t.value.substring(0,o);const s=document.createElement("span");s.textContent=t.value.substring(o)||".",n.appendChild(s);const a={top:s.offsetTop+parseInt(r.borderTopWidth),left:s.offsetLeft+parseInt(r.borderLeftWidth),height:s.offsetHeight};if(t.className.indexOf("smart-editor")>=0){const e=t.getBoundingClientRect(),o=window.getSelection().getRangeAt(0).getClientRects()[0];o&&e&&(a.left=o.left-e.left,a.top=o.top-e.top)}return n.remove(),a}Smart.Mention=class{constructor(e,t,o,n,i){this.ref=e,this.menuRef=t,this.resolveFn=o,this.replaceFn=n,this.menuItemFn=i,this.options=[],this.makeOptions=this.makeOptions.bind(this),this.closeMenu=this.closeMenu.bind(this),this.selectItem=this.selectItem.bind(this),this.onInput=this.onInput.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.renderMenu=this.renderMenu.bind(this),this.ref.addEventListener("input",this.onInput),this.ref.addEventListener("keydown",this.onKeyDown)}destroy(){this.ref.removeEventListener("input",this.onInput),this.ref.removeEventListener("keydown",this.onKeyDown)}async makeOptions(e){const t=await this.resolveFn(e);0!==t.lenght?(this.options=t,this.renderMenu()):this.closeMenu()}closeMenu(){setTimeout((()=>{this.options=[],this.left=void 0,this.top=void 0,this.triggerIdx=void 0,this.renderMenu()}),0)}selectItem(e){return()=>{const t=this.ref.value.substr(0,this.triggerIdx),o=this.options[e],n=this.replaceFn(o,this.ref.value[this.triggerIdx]),i=this.ref.value.substr(this.ref.selectionStart),r=`${t}${n}${i}`;-1!==this.ref.className.indexOf("smart-editor")?this.ref.component.execCommand("insertHTML",o.name):(this.ref.value=r,this.ref.ownerElement&&(this.ref.ownerElement.value=r));const s=this.ref.value.length-i.length;-1===this.ref.className.indexOf("smart-editor")?this.ref.setSelectionRange(s,s):this.ref.selectionStart=s,this.ref.dispatchEvent(new Event("input")),this.closeMenu(),this.ref.focus()}}onInput(e){const o=this.ref.selectionStart,n=this.ref.value.slice(0,o),i=n.split(/\s/),r=i[i.length-1],s=n.endsWith(r)?n.length-r.length:-1;if(!("@"===n[s]))return void this.closeMenu();const a=n.slice(s+1);this.makeOptions(a);const l=t(this.ref,o),{top:d,left:m}=this.ref.getBoundingClientRect();setTimeout((()=>{this.active=0,this.left=window.scrollX+l.left+m+this.ref.scrollLeft,this.top=window.scrollY+l.top+d+l.height-this.ref.scrollTop,this.triggerIdx=s,this.renderMenu()}),0)}refreshMenu(){void 0!==this.triggerIdx&&null!==this.triggerIdx&&(this.ref===document.activeElement?this.triggerIdx&&this.menuRef.classList.remove("smart-hidden"):this.menuRef.classList.add("smart-hidden"),setTimeout((()=>{const e=this.ref.selectionStart,o=t(this.ref,e),{top:n,left:i}=this.ref.getBoundingClientRect();this.left=window.scrollX+o.left+i+this.ref.scrollLeft,this.top=window.scrollY+o.top+n+o.height-this.ref.scrollTop,this.menuRef.style.left=this.left+"px",this.menuRef.style.top=this.top+"px"})))}onKeyDown(e){let t=!1;if(void 0!==this.triggerIdx)switch(e.key){case"ArrowDown":this.active=Math.min(this.active+1,this.options.length-1),this.renderMenu(),t=!0;break;case"ArrowUp":this.active=Math.max(this.active-1,0),this.renderMenu(),t=!0;break;case"Enter":case"Tab":this.selectItem(this.active)(),t=!0}t&&e.preventDefault()}renderMenu(){return void 0===this.top?(this.menuRef.hidden=!0,void this.menuRef.classList.add("smart-hidden")):this.options.length?(this.menuRef.style.left=this.left+"px",this.menuRef.style.top=this.top+"px",this.menuRef.innerHTML="",this.ref===document.activeElement&&this.menuRef.classList.remove("smart-hidden"),this.options.forEach(((e,t)=>{this.menuRef.appendChild(this.menuItemFn(e,this.selectItem(t),this.active===t))})),this.menuRef.hidden=!1,void this.menuRef.classList.remove("smart-hidden")):(this.menuRef.hidden=!0,void this.menuRef.classList.add("smart-hidden"))}}})();